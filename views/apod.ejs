<%- include('partials/header') %>

<main>
  <% if (error) { %>
    <div class="error-box">
      <strong>‚ö†Ô∏è Error:</strong> <%= error %>
    </div>
  <% } else { %>
    <!-- Flip Card -->
    <section class="apod">
      <h2>üåå Astronomy Picture of the Day</h2>
      <p><strong>Date:</strong> <%= selectedDate %></p>
    
      <% if (apod.media_type === 'image') { %>
        <img src="<%= apod.url %>" alt="<%= apod.title %>" />
      <% } else if (apod.media_type === 'video') { %>
        <div class="video-wrapper">
          <iframe src="<%= apod.url %>" allowfullscreen></iframe>
        </div>
      <% } %>
    
      <h3><%= apod.title %></h3>
      <p><%= apod.explanation %></p>
    
      <button onclick="addToFavorites()">‚ù§Ô∏è Add to Favorites</button>
    </section>
    

    <!-- Mini Gallery for Previous 5 APODs -->
    <% if (apodGallery && apodGallery.length > 0) { %>
      <section class="apod-gallery">
        <h3>üñºÔ∏è Previous 5 APODs</h3>
        <div class="gallery-grid">
          <% apodGallery.forEach(item => { %>
            <div class="gallery-item">
              <% if (item.media_type === 'image') { %>
                <img src="<%= item.url %>" alt="<%= item.title %>" />
              <% } else { %>
                <iframe src="<%= item.url %>" allowfullscreen></iframe>
              <% } %>
              <p><%= item.title %></p>
            </div>
          <% }) %>
        </div>
      </section>
    <% } %>
  <% } %>

  <div class="button-group">
    <a href="/" class="button">‚¨Ö Back to Home</a>
  </div>
</main>

<!-- Add to Favorites Script -->
<script>
  function addToFavorites() {
    const favorites = JSON.parse(localStorage.getItem('favorites')) || [];
    const newFavorite = {
      title: "<%= apod.title %>",
      url: "<%= apod.url %>",
      date: "<%= selectedDate %>",
      explanation: "<%= apod.explanation %>",
      media_type: "<%= apod.media_type %>"
    };

    const exists = favorites.some(fav => fav.date === newFavorite.date);
    if (!exists) {
      favorites.push(newFavorite);
      localStorage.setItem('favorites', JSON.stringify(favorites));
      alert("‚≠ê Added to favorites!");
    } else {
      alert("Already in favorites.");
    }
  }
</script>

<%- include('partials/footer') %>
