<%- include('partials/header') %>

<div class="hero-section">
  <div class="hero-content">
    <h2>Welcome to Space Science Explorer</h2>
    <p>Discover the latest from NASA's Astronomy Picture of the Day and upcoming SpaceX launches</p>
  </div>
</div>

<% if (error) { %>
  <div class="error-box">
    <strong>⚠️ Error:</strong> <%= error %>
  </div>
<% } else { %>
  <!-- NASA APOD Section -->
  <section class="apod-section">
    <div class="section-header">
      <h2>🌌 Astronomy Picture of the Day</h2>
      <p class="date-display"><strong>Date:</strong> <%= selectedDate %></p>
    </div>

    <% if (apod && apod.media_type) { %>
      <div class="apod-content">
        <div class="media-container">
          <% if (apod.media_type === 'image') { %>
            <img src="<%= apod.url %>" alt="<%= apod.title %>" class="apod-image" />
          <% } else if (apod.media_type === 'video') { %>
            <div class="video-wrapper">
              <iframe src="<%= apod.url %>" width="100%" height="400" allowfullscreen></iframe>
            </div>
          <% } %>
        </div>
        
        <div class="apod-info">
          <h3 class="apod-title"><%= apod.title %></h3>
          <p class="apod-explanation"><%= apod.explanation %></p>
          <div class="apod-actions">
            <a href="/apod" class="button">📅 Explore More Dates</a>
            <button onclick="addToFavorites()" class="button secondary">❤️ Add to Favorites</button>
          </div>
        </div>
      </div>
    <% } else { %>
      <div class="no-data">
        <p>No APOD data available for this date.</p>
      </div>
    <% } %>
  </section>

  <hr class="section-divider" />

  <!-- SpaceX Launches Section -->
  <section class="launches-section">
    <div class="section-header">
      <h2>🚀 Upcoming SpaceX Launches</h2>
      <p>Stay updated with the latest launch schedules</p>
    </div>

    <% if (launches && launches.length > 0) { %>
      <div class="launches-grid">
        <% launches.forEach(launch => { %>
          <div class="launch-card">
            <div class="launch-header">
              <h4 class="launch-name"><%= launch.name %></h4>
              <span class="launch-status">Upcoming</span>
            </div>
            <div class="launch-details">
              <p class="launch-date">
                🗓️ <%= new Date(launch.window_start).toLocaleString('en-US', {
                  weekday: 'long',
                  year: 'numeric',
                  month: 'long',
                  day: 'numeric',
                  hour: 'numeric',
                  minute: '2-digit',
                  hour12: true
                }) %>
              </p>
              <% if (launch.pad && launch.pad.location) { %>
                <p class="launch-location">📍 <%= launch.pad.location.name %></p>
              <% } %>
              <% if (launch.rocket && launch.rocket.configuration) { %>
                <p class="launch-rocket">🚀 <%= launch.rocket.configuration.name %></p>
              <% } %>
            </div>
          </div>
        <% }); %>
      </div>
      <div class="section-actions">
        <a href="/launches" class="button">🔭 View All Launches</a>
      </div>
    <% } else { %>
      <div class="no-data">
        <p>No upcoming launches available at the moment.</p>
      </div>
    <% } %>
  </section>
<% } %>

<script>
  function addToFavorites() {
    const favorites = JSON.parse(localStorage.getItem('favorites')) || [];
    const newFavorite = {
      title: "<%= apod ? apod.title : '' %>",
      url: "<%= apod ? apod.url : '' %>",
      date: "<%= selectedDate %>",
      explanation: "<%= apod ? apod.explanation : '' %>",
      media_type: "<%= apod ? apod.media_type : '' %>"
    };

    const exists = favorites.some(fav => fav.date === newFavorite.date);
    if (!exists) {
      favorites.push(newFavorite);
      localStorage.setItem('favorites', JSON.stringify(favorites));
      alert("⭐ Added to favorites!");
    } else {
      alert("Already in favorites.");
    }
  }
</script>

<%- include('partials/footer') %>
